//go:build !purego

// Code generated by gnark-crypto/generator. DO NOT EDIT.
// Refer to the generator for more documentation.

#include "textflag.h"
#include "funcdata.h"
#include "go_asm.h"

TEXT Â·mulAccE4_avx512(SB), NOSPLIT, $0-32
	MOVD         $const_q, AX
	VPBROADCASTD AX, Z0
	MOVD         $const_qInvNeg, AX
	VPBROADCASTD AX, Z1
	MOVQ         $0x0000000000005555, AX
	KMOVD        AX, K3
	MOVQ         alpha+0(FP), R13
	MOVQ         scale+8(FP), R14
	MOVQ         res+16(FP), CX
	MOVQ         N+24(FP), BX
	VMOVDQU32    0(R13), X2
	VINSERTI64X2 $1, X2, Y2, Y2
	VINSERTI64X4 $1, Y2, Z2, Z2
	VPSRLQ       $32, Z2, Z3
	SHRQ         $2, BX

loop_1:
	TESTQ        BX, BX
	JEQ          done_2
	DECQ         BX
	VMOVDQU32    0(CX), Z4
	VPBROADCASTD 0(R14), X5
	VPBROADCASTD 4(R14), X6
	VPBROADCASTD 8(R14), X7
	VPBROADCASTD 12(R14), X8
	VINSERTI64X2 $1, X6, Y5, Y5
	VINSERTI64X2 $1, X8, Y7, Y7
	VINSERTI64X4 $1, Y7, Z5, Z5
	VPMULUDQ     Z5, Z2, Z10
	VPMULUDQ     Z5, Z3, Z11
	VPMULUDQ     Z10, Z1, Z12
	VPMULUDQ     Z11, Z1, Z13
	VPMULUDQ     Z12, Z0, Z12
	VPADDQ       Z10, Z12, Z10
	VPMULUDQ     Z13, Z0, Z13
	VPADDQ       Z11, Z13, Z11
	VMOVSHDUP    Z10, K3, Z11
	VPSUBD       Z0, Z11, Z12
	VPMINUD      Z11, Z12, Z9
	VPADDD       Z4, Z9, Z4     // result = result + acc
	VPSUBD       Z0, Z4, Z9
	VPMINUD      Z4, Z9, Z4
	VMOVDQU32    Z4, 0(CX)
	ADDQ         $64, CX
	ADDQ         $16, R14
	JMP          loop_1

done_2:
	RET
